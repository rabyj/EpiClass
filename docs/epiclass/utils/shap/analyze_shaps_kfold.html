<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
<meta name="generator" content="pdoc3 0.11.0">
<title>epiclass.utils.shap.analyze_shaps_kfold API documentation</title>
<meta name="description" content="For every folder of a cross-validation, take already computed SHAP values and analyze them …">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/sanitize.min.css" integrity="sha512-y1dtMcuvtTMJc1yPgEqF0ZjQbhnc/bFhyvIyVNb9Zk5mIGtqVaAB1Ttl28su8AvFMOY0EwRbAe+HCLqj6W7/KA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/typography.min.css" integrity="sha512-Y1DYSb995BAfxobCkKepB1BqJJTPrOp3zPL74AWFugHHmmdcvO+C48WLrUOlhGMc0QG7AE3f7gmvvcrmX2fDoA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:1.5em;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:2em 0 .50em 0}h3{font-size:1.4em;margin:1.6em 0 .7em 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .2s ease-in-out}a:visited{color:#503}a:hover{color:#b62}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900;font-weight:bold}pre code{font-size:.8em;line-height:1.4em;padding:1em;display:block}code{background:#f3f3f3;font-family:"DejaVu Sans Mono",monospace;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em 1em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul ul{padding-left:1em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js" integrity="sha512-D9gUyxqja7hBtkWpPWGt9wfbfaMGVt9gnyCvYa+jojwwPHLCzUm5i8rpk7vD7wNee9bA35eYIjobYPaQuKS1MQ==" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => {
hljs.configure({languages: ['bash', 'css', 'diff', 'graphql', 'ini', 'javascript', 'json', 'plaintext', 'python', 'python-repl', 'rust', 'shell', 'sql', 'typescript', 'xml', 'yaml']});
hljs.highlightAll();
})</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>epiclass.utils.shap.analyze_shaps_kfold</code></h1>
</header>
<section id="section-intro">
<p>For every folder of a cross-validation, take already computed SHAP values and analyze them.</p>
<p>The following analyses are performed:
- Writing bed files of most frequent features in the N most high SHAP values (absolute value).
e.g for N=100, the top 100 most high SHAP values (absolute value) are taken for each sample,
counted, and features that are present in X% of the samples are written to bed.
This is done for each class separately, using the output class SHAP matrix.
(There are SHAP values for all features, for each class, for each sample, thus multiple matrices, one per class.)
- For all samples of the classifier class
- Subsampled by assay
- Subsampled by cell type and assay</p>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="epiclass.utils.shap.analyze_shaps_kfold.analyze_shap_fold"><code class="name flex">
<span>def <span class="ident">analyze_shap_fold</span></span>(<span>extract_shap_values_and_info_output: Tuple[np.ndarray, List[str], List[Tuple[str, str]]], output_folder: Path, metadata: Metadata, label_category: str, chromsizes: List[Tuple[str, int]], resolution: int, overwrite: bool, top_N_required: int = 100, min_percentile: float = 80, copy_metadata: bool = True) ‑> Dict[str, Dict[~KT, ~VT]]</span>
</code></dt>
<dd>
<div class="desc"><p>Analyzes SHAP values from one fold of the training and writes BED files of most frequent important features.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>extract_shap_values_and_info_output</code></strong> :&ensp;<code>Tuple[np.ndarray, List[str], List[Tuple[str, str]]]</code></dt>
<dd>Output of extract_shap_values_and_info.</dd>
<dt><strong><code>output_folder</code></strong> :&ensp;<code>Path</code></dt>
<dd>The directory to write the results to.</dd>
<dt><strong><code>metadata</code></strong> :&ensp;<code>Metadata</code></dt>
<dd>Metadata object containing label information.</dd>
<dt><strong><code>label_category</code></strong> :&ensp;<code>str</code></dt>
<dd>The category of labels to consider.</dd>
<dt><strong><code>chromsizes</code></strong> :&ensp;<code>List[Tuple[str, int]]</code></dt>
<dd>List with chromosome names and sizes.</dd>
<dt><strong><code>resolution</code></strong> :&ensp;<code>int</code></dt>
<dd>The resolution for binning.</dd>
<dt><strong><code>overwrite</code></strong> :&ensp;<code>bool</code></dt>
<dd>Whether to overwrite existing files.</dd>
<dt><strong><code>top_N_required</code></strong> :&ensp;<code>int</code>, optional</dt>
<dd>The number of top SHAP values/features to consider per sample. Defaults to 100.</dd>
<dt><strong><code>min_percentile</code></strong> :&ensp;<code>float</code>, optional</dt>
<dd>The percentile value for feature frequency selection (0 &lt; x &lt; 100). Defaults to 80.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>Dict[str, Dict]</code></dt>
<dd>A dictionary containing important features for each analyzed class label.</dd>
</dl>
<p>The keys are class labels, and values are dictionaries of important features for different percentiles.</p></div>
</dd>
<dt id="epiclass.utils.shap.analyze_shaps_kfold.analyze_single_fold"><code class="name flex">
<span>def <span class="ident">analyze_single_fold</span></span>(<span>split_folder: Path, metadata: Metadata, chromsizes: List[Tuple[str, int]], label_category: str, resolution: int, top_N_required: int, min_percentile: float, overwrite: bool) ‑> None</span>
</code></dt>
<dd>
<div class="desc"><p>Analyze SHAP values for a single fold.</p></div>
</dd>
<dt id="epiclass.utils.shap.analyze_shaps_kfold.analyze_subsamplings"><code class="name flex">
<span>def <span class="ident">analyze_subsamplings</span></span>(<span>shap_folder: Path, output_folder: Path, metadata: Metadata, chromsizes: List[Tuple[str, int]], label_category: str, subsample_categories: List[List[str]], resolution: int, overwrite: bool, top_N_required: int = 100, min_percentile: float = 80) ‑> None</span>
</code></dt>
<dd>
<div class="desc"><p>Analyzes SHAP values for given subsampling category combinations for an individual split.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>shap_folder</code></strong> :&ensp;<code>Path</code></dt>
<dd>Path to the folder containing SHAP values.</dd>
<dt><strong><code>output_folder</code></strong> :&ensp;<code>Path</code></dt>
<dd>Path to the folder where analysis results will be stored.</dd>
<dt><strong><code>metadata</code></strong> :&ensp;<code>Metadata</code></dt>
<dd>Metadata object containing sample information.</dd>
<dt><strong><code>chromsizes</code></strong></dt>
<dd>List[Tuple[str, int]]: Chromosome sizes information.</dd>
<dt><strong><code>label_category</code></strong> :&ensp;<code>str</code></dt>
<dd>Primary category for labels.</dd>
<dt><strong><code>subsample_categories</code></strong> :&ensp;<code>List[List[str]]</code></dt>
<dd>List of category combinations for subsampling.</dd>
<dt><strong><code>resolution</code></strong> :&ensp;<code>int</code></dt>
<dd>Resolution of the sample binning.</dd>
<dt><strong><code>overwrite</code></strong> :&ensp;<code>bool</code></dt>
<dd>Flag to overwrite existing data. Defaults to False.</dd>
<dt><strong><code>top_N_required</code></strong> :&ensp;<code>int</code></dt>
<dd>Number of top features required. Defaults to 100.</dd>
<dt><strong><code>min_percentile</code></strong> :&ensp;<code>float</code></dt>
<dd>Minimum percentile for filtering over samples (0 &lt; val &lt; 100). Defaults to 80.</dd>
</dl></div>
</dd>
<dt id="epiclass.utils.shap.analyze_shaps_kfold.get_resolution_from_path"><code class="name flex">
<span>def <span class="ident">get_resolution_from_path</span></span>(<span>path: Path) ‑> int</span>
</code></dt>
<dd>
<div class="desc"><p>Extract resolution from path.</p></div>
</dd>
<dt id="epiclass.utils.shap.analyze_shaps_kfold.main"><code class="name flex">
<span>def <span class="ident">main</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"><p>Main function.</p></div>
</dd>
<dt id="epiclass.utils.shap.analyze_shaps_kfold.parse_arguments"><code class="name flex">
<span>def <span class="ident">parse_arguments</span></span>(<span>) ‑> argparse.Namespace</span>
</code></dt>
<dd>
<div class="desc"><p>Argument parser for command line.</p></div>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="epiclass.utils.shap" href="index.html">epiclass.utils.shap</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="epiclass.utils.shap.analyze_shaps_kfold.analyze_shap_fold" href="#epiclass.utils.shap.analyze_shaps_kfold.analyze_shap_fold">analyze_shap_fold</a></code></li>
<li><code><a title="epiclass.utils.shap.analyze_shaps_kfold.analyze_single_fold" href="#epiclass.utils.shap.analyze_shaps_kfold.analyze_single_fold">analyze_single_fold</a></code></li>
<li><code><a title="epiclass.utils.shap.analyze_shaps_kfold.analyze_subsamplings" href="#epiclass.utils.shap.analyze_shaps_kfold.analyze_subsamplings">analyze_subsamplings</a></code></li>
<li><code><a title="epiclass.utils.shap.analyze_shaps_kfold.get_resolution_from_path" href="#epiclass.utils.shap.analyze_shaps_kfold.get_resolution_from_path">get_resolution_from_path</a></code></li>
<li><code><a title="epiclass.utils.shap.analyze_shaps_kfold.main" href="#epiclass.utils.shap.analyze_shaps_kfold.main">main</a></code></li>
<li><code><a title="epiclass.utils.shap.analyze_shaps_kfold.parse_arguments" href="#epiclass.utils.shap.analyze_shaps_kfold.parse_arguments">parse_arguments</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.11.0</a>.</p>
</footer>
</body>
</html>
